{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Thermodynamic Routing v2 Summary",
  "tag": "thermo-routing-v2",
  "type": "object",
  "properties": {
    "tag": {"type": "string"},
    "domain": {"type": "string"},
    "env": {
      "type": "object",
      "properties": {
        "threads": {"type": "integer"},
        "blas": {"type": "string"},
        "fft": {"type": "string"},
        "fft_plan_mode": {"type": "string"}
      },
      "required": ["threads", "blas", "fft"]
    },
    "receipts": {
      "type": "object",
      "properties": {
        "no_switch": {"type": "string", "enum": ["bitwise", "linf", "ulp"]},
        "checkpoint_hashes": {"type": "array", "items": {"type": "string"}}
      },
      "required": ["no_switch", "checkpoint_hashes"]
    },
    "kpi": {
      "type": "object",
      "properties": {
        "h_theorem": {"type": "object", "properties": {"violations": {"type": "integer"}}, "required": ["violations"]},
        "rj_fit": {
          "type": "object",
          "properties": {
            "R2": {"type": "number"},
            "k_min": {"type": "integer"},
            "k_max": {"type": "integer"},
            "dw": {"type": "number"},
            "ljung_box_p": {"type": "number"}
          },
          "required": ["R2", "k_min", "k_max"]
        },
        "bias": {
          "type": "object",
          "properties": {
            "B": {"type": "number"},
            "rho": {"type": "number"},
            "ci": {"type": "array", "items": {"type": "number"}, "minItems": 2, "maxItems": 2},
            "ci_width": {"type": "number"}
          },
          "required": ["B", "rho", "ci"]
        }
      },
      "required": ["h_theorem", "rj_fit", "bias"]
    },
    "artifacts": {
      "type": "object",
      "properties": {
        "figures": {"type": "array", "items": {"type": "string"}},
        "logs": {"type": "array", "items": {"type": "string"}}
      }
    }
  },
  "required": ["tag", "domain", "env", "receipts", "kpi", "artifacts"]
}
